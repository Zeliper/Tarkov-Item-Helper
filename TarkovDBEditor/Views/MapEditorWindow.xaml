<Window x:Class="TarkovDBEditor.Views.MapEditorWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:svgc="http://sharpvectors.codeplex.com/svgc/"
        Title="Map Editor" Height="900" Width="1400"
        Background="#0F0F0F"
        WindowStartupLocation="CenterScreen">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Top Control Panel -->
        <Border Grid.Row="0" Background="#1A1A1A" Padding="10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Map Selector -->
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <TextBlock Text="Map:" Foreground="#9A8866" VerticalAlignment="Center" Margin="0,0,10,0"/>
                    <ComboBox x:Name="MapSelector" Width="200" Height="28"
                              SelectionChanged="MapSelector_SelectionChanged"
                              DisplayMemberPath="DisplayName"/>

                    <!-- Floor Selector -->
                    <TextBlock x:Name="TxtFloorLabel" Text="Floor:" Foreground="#9A8866"
                               VerticalAlignment="Center" Margin="20,0,10,0" Visibility="Collapsed"/>
                    <ComboBox x:Name="FloorSelector" Width="120" Height="28"
                              SelectionChanged="FloorSelector_SelectionChanged"
                              Visibility="Collapsed"/>
                </StackPanel>

                <!-- Objective Info (shown when editing objective) -->
                <Border x:Name="ObjectiveInfoPanel" Grid.Column="1" Background="#252525" CornerRadius="4" Padding="10,5" Margin="20,0">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Objective:" Foreground="#666" Margin="0,0,8,0"/>
                            <TextBlock x:Name="ObjectiveDescriptionText" Text="-" Foreground="#9A8866"
                                       TextTrimming="CharacterEllipsis" MaxWidth="400"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                            <!-- Point Type Toggle -->
                            <Border x:Name="PointTypeToggleContainer" CornerRadius="4" Background="#333" Margin="0,0,16,0">
                                <StackPanel Orientation="Horizontal">
                                    <Button x:Name="BtnLocationMode" Content="Area" Padding="12,4"
                                            Background="#70A800" Foreground="White" BorderThickness="0"
                                            Click="PointTypeToggle_Click" Tag="Location"/>
                                    <Button x:Name="BtnOptionalMode" Content="OR Locations" Padding="12,4"
                                            Background="#444" Foreground="#888" BorderThickness="0"
                                            Click="PointTypeToggle_Click" Tag="Optional"/>
                                </StackPanel>
                            </Border>
                            <TextBlock Text="Points:" Foreground="#666" Margin="0,0,8,0" VerticalAlignment="Center"/>
                            <TextBlock x:Name="PointsCountText" Text="0" Foreground="#70A800" VerticalAlignment="Center"/>
                            <TextBlock x:Name="OptionalPointsCountText" Text=" / 0 OR" Foreground="#FF5722" VerticalAlignment="Center" Margin="4,0,0,0"/>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- Marker Editor Panel (shown in marker mode) -->
                <Border x:Name="MarkerEditorPanel" Grid.Column="1" Background="#252525" CornerRadius="4" Padding="10,5" Margin="20,0" Visibility="Collapsed">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Marker Type:" Foreground="#666" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <ComboBox x:Name="MarkerTypeSelector" Width="150" Height="28"
                                  SelectionChanged="MarkerTypeSelector_SelectionChanged"/>
                        <TextBlock Text="Name:" Foreground="#666" VerticalAlignment="Center" Margin="15,0,8,0"/>
                        <TextBox x:Name="MarkerNameInput" Width="200" Height="28"
                                 Background="#333" Foreground="#FFF" BorderThickness="1" BorderBrush="#555"
                                 Padding="5,3" VerticalContentAlignment="Center"/>
                        <TextBlock Text="Markers:" Foreground="#666" VerticalAlignment="Center" Margin="15,0,8,0"/>
                        <TextBlock x:Name="MarkerCountText" Text="0" Foreground="#FF9800" VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>

                <!-- Action Buttons -->
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <Button x:Name="ClearPointsButton" Content="Clear Points" Click="ClearPoints_Click"
                            Background="#C62828" Foreground="White" BorderThickness="0"
                            Padding="15,5" Margin="0,0,10,0"/>
                    <Button x:Name="ClearMarkersButton" Content="Clear Markers" Click="ClearMarkers_Click"
                            Background="#C62828" Foreground="White" BorderThickness="0"
                            Padding="15,5" Margin="0,0,10,0" Visibility="Collapsed"/>
                    <Button x:Name="SaveButton" Content="Save &amp; Close" Click="SaveAndClose_Click"
                            Background="#70A800" Foreground="White" BorderThickness="0"
                            Padding="15,5"/>
                    <Button x:Name="ExportMarkersButton" Content="Export Markers" Click="ExportMarkers_Click"
                            Background="#2196F3" Foreground="White" BorderThickness="0"
                            Padding="15,5" Margin="10,0,0,0" Visibility="Collapsed"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Map Container -->
        <Border Grid.Row="1" Background="#0F0F10" ClipToBounds="True">
            <Grid x:Name="MapViewerGrid"
                  Background="Transparent"
                  MouseLeftButtonDown="MapViewer_MouseLeftButtonDown"
                  MouseLeftButtonUp="MapViewer_MouseLeftButtonUp"
                  MouseRightButtonDown="MapViewer_MouseRightButtonDown"
                  MouseMove="MapViewer_MouseMove"
                  MouseWheel="MapViewer_MouseWheel">

                <!-- Zoom Control Panel -->
                <Border HorizontalAlignment="Right" VerticalAlignment="Top"
                        Margin="0,8,24,0" Panel.ZIndex="100"
                        Background="#1A1A1A" CornerRadius="4" Padding="8,4">
                    <StackPanel Orientation="Horizontal">
                        <Button Content="-" Width="28" Height="28" Padding="0"
                                Background="#333" Foreground="#9A8866" BorderThickness="0"
                                Click="BtnZoomOut_Click" Margin="0,0,4,0"/>
                        <TextBlock x:Name="ZoomText" Text="100%" Width="50"
                                   Foreground="#9A8866" VerticalAlignment="Center"
                                   TextAlignment="Center"/>
                        <Button Content="+" Width="28" Height="28" Padding="0"
                                Background="#333" Foreground="#9A8866" BorderThickness="0"
                                Click="BtnZoomIn_Click" Margin="4,0,4,0"/>
                        <Button Content="Reset" Padding="8,4"
                                Background="#333" Foreground="#9A8866" BorderThickness="0"
                                Click="BtnResetView_Click" Margin="4,0,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Instructions Panel -->
                <Border HorizontalAlignment="Left" VerticalAlignment="Top"
                        Margin="8,8,0,0" Panel.ZIndex="100"
                        Background="#1A1A1A" CornerRadius="4" Padding="10,6">
                    <StackPanel>
                        <TextBlock Text="Controls:" Foreground="#9A8866" FontWeight="Bold" Margin="0,0,0,4"/>
                        <TextBlock Text="• Left-click: Add point/marker" Foreground="#888" FontSize="11"/>
                        <TextBlock Text="• Right-click: Remove last point" Foreground="#888" FontSize="11"/>
                        <TextBlock Text="• Drag: Pan map" Foreground="#888" FontSize="11"/>
                        <TextBlock Text="• Scroll: Zoom" Foreground="#888" FontSize="11"/>
                        <TextBlock x:Name="TxtFloorHotkeys" Text="• Numpad 0~5: Select floor" Foreground="#888" FontSize="11" Visibility="Collapsed"/>
                        <TextBlock x:Name="TxtMarkerControls" Text="• Ctrl+Click: Select/Drag marker" Foreground="#888" FontSize="11" Visibility="Collapsed"/>
                        <TextBlock x:Name="TxtMarkerDelete" Text="• Delete: Remove selected marker" Foreground="#888" FontSize="11" Visibility="Collapsed"/>
                    </StackPanel>
                </Border>

                <!-- Map Canvas -->
                <Canvas x:Name="MapCanvas" Background="#000"
                        HorizontalAlignment="Left" VerticalAlignment="Top">
                    <Canvas.RenderTransform>
                        <TransformGroup>
                            <ScaleTransform x:Name="MapScale" ScaleX="1" ScaleY="1"/>
                            <TranslateTransform x:Name="MapTranslate" X="0" Y="0"/>
                        </TransformGroup>
                    </Canvas.RenderTransform>

                    <!-- Map SVG -->
                    <svgc:SvgViewbox x:Name="MapSvg" Stretch="None"/>

                    <!-- Location Points Canvas -->
                    <Canvas x:Name="PointsCanvas"/>

                    <!-- Map Markers Canvas -->
                    <Canvas x:Name="MarkersCanvas"/>

                    <!-- Player Position Canvas -->
                    <Canvas x:Name="PlayerCanvas"/>
                </Canvas>
            </Grid>
        </Border>

        <!-- Status Bar -->
        <Border Grid.Row="2" Background="#1A1A1A" Padding="10,5">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <TextBlock Text="Game Coords:" Foreground="#666" Margin="0,0,5,0"/>
                    <TextBlock x:Name="GameCoordsText" Text="X: -, Z: -" Foreground="#9A8866" Margin="0,0,20,0"/>
                    <TextBlock Text="Screen Coords:" Foreground="#666" Margin="0,0,5,0"/>
                    <TextBlock x:Name="ScreenCoordsText" Text="X: -, Y: -" Foreground="#70A800" Margin="0,0,20,0"/>
                    <!-- Player Position from Watcher -->
                    <Border x:Name="WatcherStatusBorder" CornerRadius="3" Padding="8,2" Margin="10,0,0,0"
                            Background="#333" BorderBrush="#555" BorderThickness="1">
                        <StackPanel Orientation="Horizontal">
                            <Ellipse x:Name="WatcherIndicator" Width="8" Height="8" Fill="#666" Margin="0,0,6,0"/>
                            <TextBlock x:Name="PlayerPositionText" Text="Player: --" Foreground="#00BCD4"/>
                            <Button x:Name="WatcherToggleButton" Content="Start" Padding="6,1" Margin="10,0,0,0"
                                    Background="#444" Foreground="#CCC" BorderThickness="0" FontSize="10"
                                    Click="WatcherToggleButton_Click"/>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <TextBlock Grid.Column="1" x:Name="StatusText" Text="Ready" Foreground="#666"/>
            </Grid>
        </Border>
    </Grid>
</Window>
