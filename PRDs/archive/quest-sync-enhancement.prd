# Quest Sync Enhancement PRD (í€˜ìŠ¤íŠ¸ ë™ê¸°í™” ê°œì„ )

## Overview
í€˜ìŠ¤íŠ¸ ë¡œê·¸ ë™ê¸°í™” ê¸°ëŠ¥ì˜ UX ê°œì„ . ê³„ì • ì´ˆê¸°í™”(ì™€ì´í”„) ì‹œ ë¡œê·¸ ì •ë¦¬ ì•ˆë‚´ì™€ ë™ê¸°í™” ê²°ê³¼ì—ì„œ ì§„í–‰ì¤‘ í€˜ìŠ¤íŠ¸ í‘œì‹œ ê¸°ëŠ¥ ì¶”ê°€. (ì˜ì–´, í•œêµ­ì–´, ì¼ë³¸ì–´ ì–¸ì–´ ì„¤ì •ë”°ë¼ì„œ ì•ˆë‚´ê°€ ë‚˜ì™€ì•¼í•¨)

## Reference
- ì—°ê³„ ë¬¸ì„œ: `PRDs/quest-sync.prd`
- ê¸°ì¡´ ì„œë¹„ìŠ¤: `LogSyncService.cs`, `QuestProgressService.cs`

---

## Features

### 1. ê³„ì • ì´ˆê¸°í™” ì•ˆë‚´ íŒì—…

#### 1.1 íŠ¸ë¦¬ê±° ì¡°ê±´
ì„¤ì • ë©”ë‰´ì—ì„œ "í€˜ìŠ¤íŠ¸ ë™ê¸°í™”" ë²„íŠ¼ í´ë¦­ ì‹œ, ë™ê¸°í™” ì‹¤í–‰ ì „ ì•ˆë‚´ íŒì—…ì„ ë¨¼ì € í‘œì‹œí•œë‹¤.

#### 1.2 UI ë””ìì¸

```
+------------------------------------------------------------------+
| âš ï¸ í€˜ìŠ¤íŠ¸ ë™ê¸°í™” ì „ í™•ì¸                                          |
+------------------------------------------------------------------+
|                                                                   |
| ìµœê·¼ ê³„ì • ì´ˆê¸°í™”(ì™€ì´í”„)ë¥¼ ì§„í–‰í•˜ì…¨ë‚˜ìš”?                           |
|                                                                   |
| ê³„ì • ì´ˆê¸°í™” í›„ ë™ê¸°í™”ë¥¼ ì§„í–‰í•˜ë©´ ì´ì „ ì‹œì¦Œì˜ ë¡œê·¸ê°€ ì„ì—¬            |
| í€˜ìŠ¤íŠ¸ ì§„í–‰ ìƒíƒœê°€ ì˜¬ë°”ë¥´ì§€ ì•Šê²Œ í‘œì‹œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.                |
|                                                                   |
| ğŸ“ ë¡œê·¸ í´ë” ìœ„ì¹˜:                                                 |
| C:\Users\...\Battlestate Games\EFT\Logs                           |
|                                                                   |
| ğŸ’¡ ê¶Œì¥ ì¡°ì¹˜:                                                      |
| ê³„ì • ì´ˆê¸°í™” ì´ì „ ë‚ ì§œì˜ ë¡œê·¸ í´ë”ë¥¼ ì‚­ì œí•˜ê±°ë‚˜                      |
| ë‹¤ë¥¸ ìœ„ì¹˜ë¡œ ë°±ì—…í•´ ì£¼ì„¸ìš”.                                         |
|                                                                   |
|                      [í´ë” ì—´ê¸°]  [ê³„ì† ì§„í–‰]                       |
+------------------------------------------------------------------+
```

#### 1.3 ë²„íŠ¼ ë™ì‘

| ë²„íŠ¼ | ë™ì‘ |
|------|------|
| í´ë” ì—´ê¸° | ë¡œê·¸ í´ë”ë¥¼ Windows íƒìƒ‰ê¸°ë¡œ ì—´ê¸° (`Process.Start("explorer.exe", logPath)`) |
| ê³„ì† ì§„í–‰ | íŒì—… ë‹«ê³  ë™ê¸°í™” ì‹¤í–‰ |

#### 1.4 "ë‹¤ì‹œ ë³´ì§€ ì•Šê¸°" ì˜µì…˜

```
+------------------------------------------------------------------+
| [âœ“] ì´ ì•ˆë‚´ë¥¼ ë‹¤ì‹œ ë³´ì§€ ì•Šê¸°                                       |
+------------------------------------------------------------------+
```

- ì²´í¬ ì‹œ `settings.json`ì— `"hideWipeWarning": true` ì €ì¥
- ì„¤ì • í˜ì´ì§€ì—ì„œ ë‹¤ì‹œ í™œì„±í™” ê°€ëŠ¥

#### 1.5 ë‹¤êµ­ì–´ ì§€ì›

**í•œêµ­ì–´:**
```
ìµœê·¼ ê³„ì • ì´ˆê¸°í™”(ì™€ì´í”„)ë¥¼ ì§„í–‰í•˜ì…¨ë‚˜ìš”?
```

**English:**
```
Have you recently reset your account (wipe)?
```

**æ—¥æœ¬èª:**
```
æœ€è¿‘ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆï¼ˆãƒ¯ã‚¤ãƒ—ï¼‰ã—ã¾ã—ãŸã‹ï¼Ÿ
```

---

### 2. ì§„í–‰ì¤‘ í€˜ìŠ¤íŠ¸ í‘œì‹œ ê¸°ëŠ¥

#### 2.1 ë™ê¸°í™” ê²°ê³¼ í™”ë©´ ê°œì„ 

ê¸°ì¡´ ë™ê¸°í™” ê²°ê³¼ ë‹¤ì´ì–¼ë¡œê·¸ë¥¼ ì¢Œìš° 2ì»¬ëŸ¼ ë ˆì´ì•„ì›ƒìœ¼ë¡œ ë³€ê²½í•œë‹¤.

```
+------------------------------------------------------------------+
| í€˜ìŠ¤íŠ¸ ë™ê¸°í™” ì™„ë£Œ                                                 |
+------------------------------------------------------------------+
|  ì™„ë£Œëœ í€˜ìŠ¤íŠ¸ (35)          |  ì§„í–‰ì¤‘ í€˜ìŠ¤íŠ¸ (8)                  |
| ----------------------------|-------------------------------------|
| âœ“ Debut                     | â— Delivery from the Past            |
| âœ“ Checking                  | â— The Punisher - Part 4             |
| âœ“ Shootout Picnic           | â— Colleagues - Part 3               |
| âœ“ Acquaintance              | â— Gratitude                         |
| âœ“ Supplier                  | â— Setup                             |
| âœ“ The Extortionist          | â— Insomnia                          |
| âœ“ Stirrup                   | â— Test Drive - Part 1               |
| âœ“ What's on the Flash Drive | â— The Guide                         |
| ... (ë”ë³´ê¸°)                 |                                     |
|                             |                                     |
| ìë™ ì™„ë£Œëœ ì„ í–‰ í€˜ìŠ¤íŠ¸: 23  |                                     |
| ë§¤ì¹­ ì‹¤íŒ¨: 3                 |                                     |
+------------------------------------------------------------------+
|                        [í™•ì¸]                                      |
+------------------------------------------------------------------+
```

#### 2.2 ì§„í–‰ì¤‘ í€˜ìŠ¤íŠ¸ ì •ì˜

**ì§„í–‰ì¤‘(In Progress) ìƒíƒœ:**
- ë¡œê·¸ì—ì„œ `message.type == 10` (Started) ì´ë²¤íŠ¸ê°€ ë°œê²¬ë¨
- í•´ë‹¹ í€˜ìŠ¤íŠ¸ì˜ `message.type == 12` (Completed) ë˜ëŠ” `message.type == 11` (Failed) ì´ë²¤íŠ¸ê°€ ì—†ìŒ

```csharp
public class SyncResult
{
    // ê¸°ì¡´ í•„ë“œ
    public int TotalEventsFound { get; set; }
    public int QuestsCompleted { get; set; }
    public int QuestsFailed { get; set; }
    public int PrerequisitesAutoCompleted { get; set; }
    public List<string> UnmatchedQuestIds { get; set; }

    // ì‹ ê·œ í•„ë“œ
    public List<TarkovTask> InProgressQuests { get; set; }  // ì§„í–‰ì¤‘ í€˜ìŠ¤íŠ¸ ëª©ë¡
    public List<TarkovTask> CompletedQuests { get; set; }   // ì™„ë£Œëœ í€˜ìŠ¤íŠ¸ ëª©ë¡
}
```

#### 2.3 ì§„í–‰ì¤‘ í€˜ìŠ¤íŠ¸ ì²˜ë¦¬ ë¡œì§

```csharp
public void ProcessQuestEvents(List<QuestLogEvent> events)
{
    // í€˜ìŠ¤íŠ¸ë³„ë¡œ ì´ë²¤íŠ¸ ê·¸ë£¹í™”
    var questEvents = events
        .GroupBy(e => e.QuestId)
        .ToDictionary(g => g.Key, g => g.ToList());

    var inProgressQuests = new List<TarkovTask>();
    var completedQuests = new List<TarkovTask>();

    foreach (var (questId, questEventList) in questEvents)
    {
        var task = FindTaskByQuestId(questId);
        if (task == null) continue;

        // ìµœì‹  ì´ë²¤íŠ¸ ê¸°ì¤€ìœ¼ë¡œ ìƒíƒœ íŒë‹¨
        var latestEvent = questEventList.OrderByDescending(e => e.Timestamp).First();

        switch (latestEvent.EventType)
        {
            case QuestEventType.Started:
                // ì‹œì‘ë§Œ ë¨, ì™„ë£Œ/ì‹¤íŒ¨ ì´ë²¤íŠ¸ ì—†ìŒ = ì§„í–‰ì¤‘
                inProgressQuests.Add(task);
                _progressService.SetQuestStatus(task.NormalizedName, QuestStatus.Active);
                break;

            case QuestEventType.Completed:
                completedQuests.Add(task);
                _progressService.SetQuestStatus(task.NormalizedName, QuestStatus.Done);
                break;

            case QuestEventType.Failed:
                _progressService.SetQuestStatus(task.NormalizedName, QuestStatus.Failed);
                break;
        }
    }

    return new SyncResult
    {
        InProgressQuests = inProgressQuests,
        CompletedQuests = completedQuests,
        // ...
    };
}
```

#### 2.4 ì§„í–‰ì¤‘ í€˜ìŠ¤íŠ¸ UI ë™ì‘

- í´ë¦­ ì‹œ í•´ë‹¹ í€˜ìŠ¤íŠ¸ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™
- ë§ˆìš°ìŠ¤ ì˜¤ë²„ ì‹œ íŠ¸ë ˆì´ë”, í•„ìš” ë ˆë²¨ ë“± íˆ´íŒ í‘œì‹œ
- ëª©ë¡ì´ ê¸¸ë©´ ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•œ ë¦¬ìŠ¤íŠ¸ë¡œ í‘œì‹œ

---

### 3. Settings ì €ì¥ êµ¬ì¡°

```json
{
  "logSyncSettings": {
    "logDirectory": "C:\\Users\\...\\Battlestate Games\\EFT\\Logs",
    "autoSyncOnStart": true,
    "hideWipeWarning": false,
    "lastSyncTimestamp": "2025-12-02T08:00:00Z"
  }
}
```

---

## Implementation Steps

### Phase 1: ê³„ì • ì´ˆê¸°í™” ì•ˆë‚´ íŒì—…
1. ì•ˆë‚´ ë‹¤ì´ì–¼ë¡œê·¸ XAML ìƒì„±
2. "í´ë” ì—´ê¸°" ë²„íŠ¼ êµ¬í˜„ (`Process.Start`)
3. "ë‹¤ì‹œ ë³´ì§€ ì•Šê¸°" ì„¤ì • ì €ì¥/ë¡œë“œ
4. ë‹¤êµ­ì–´ ë¦¬ì†ŒìŠ¤ ì¶”ê°€

### Phase 2: ì§„í–‰ì¤‘ í€˜ìŠ¤íŠ¸ í‘œì‹œ
1. `SyncResult`ì— `InProgressQuests`, `CompletedQuests` í•„ë“œ ì¶”ê°€
2. `ProcessQuestEvents` ë¡œì§ ìˆ˜ì •
3. ë™ê¸°í™” ê²°ê³¼ ë‹¤ì´ì–¼ë¡œê·¸ 2ì»¬ëŸ¼ ë ˆì´ì•„ì›ƒìœ¼ë¡œ ë³€ê²½
4. í€˜ìŠ¤íŠ¸ ëª©ë¡ ìŠ¤í¬ë¡¤/í´ë¦­ ë™ì‘ êµ¬í˜„

### Phase 3: í†µí•© í…ŒìŠ¤íŠ¸
1. ì™€ì´í”„ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ (ì´ì „ ë¡œê·¸ + ìƒˆ ë¡œê·¸)
2. ë‹¤ì–‘í•œ í€˜ìŠ¤íŠ¸ ìƒíƒœ ì¡°í•© í…ŒìŠ¤íŠ¸
3. UI ë ˆì´ì•„ì›ƒ ê²€ì¦

---

## UI Mockups

### 3.1 ë™ê¸°í™” ê²°ê³¼ ë‹¤ì´ì–¼ë¡œê·¸ ìƒì„¸

```
+------------------------------------------------------------------+
| í€˜ìŠ¤íŠ¸ ë™ê¸°í™” ì™„ë£Œ                                    [X]          |
+------------------------------------------------------------------+
|                                                                   |
|  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” |
|  â”‚ ì™„ë£Œëœ í€˜ìŠ¤íŠ¸ (35)      â”‚  â”‚ ì§„í–‰ì¤‘ í€˜ìŠ¤íŠ¸ (8)               â”‚ |
|  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ |
|  â”‚ âœ“ Debut                 â”‚  â”‚ â— Delivery from the Past        â”‚ |
|  â”‚   í”„ë¼í¼                â”‚  â”‚   í…Œë¼í”¼ìŠ¤íŠ¸                    â”‚ |
|  â”‚                         â”‚  â”‚                                 â”‚ |
|  â”‚ âœ“ Checking              â”‚  â”‚ â— The Punisher - Part 4         â”‚ |
|  â”‚   í”„ë¼í¼                â”‚  â”‚   í”„ë¼í¼                        â”‚ |
|  â”‚                         â”‚  â”‚                                 â”‚ |
|  â”‚ âœ“ Shootout Picnic       â”‚  â”‚ â— Colleagues - Part 3           â”‚ |
|  â”‚   í”„ë¼í¼                â”‚  â”‚   í…Œë¼í”¼ìŠ¤íŠ¸                    â”‚ |
|  â”‚                         â”‚  â”‚                                 â”‚ |
|  â”‚ [ìŠ¤í¬ë¡¤ ê°€ëŠ¥...]        â”‚  â”‚                                 â”‚ |
|  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ |
|                                                                   |
|  ìš”ì•½:                                                            |
|  â”œâ”€ ë¡œê·¸ì—ì„œ ë°œê²¬ëœ ì´ë²¤íŠ¸: 86                                    |
|  â”œâ”€ ìë™ ì™„ë£Œëœ ì„ í–‰ í€˜ìŠ¤íŠ¸: 23                                   |
|  â””â”€ ë§¤ì¹­ ì‹¤íŒ¨í•œ í€˜ìŠ¤íŠ¸ ID: 3                                      |
|                                                                   |
+------------------------------------------------------------------+
|                           [í™•ì¸]                                   |
+------------------------------------------------------------------+
```

### 3.2 ì§„í–‰ì¤‘ í€˜ìŠ¤íŠ¸ íˆ´íŒ

```
+----------------------------------+
| Delivery from the Past           |
| ê³¼ê±°ë¡œë¶€í„°ì˜ ë°°ë‹¬                 |
|----------------------------------|
| íŠ¸ë ˆì´ë”: í…Œë¼í”¼ìŠ¤íŠ¸              |
| í•„ìš” ë ˆë²¨: 17                     |
| Kappa í•„ìˆ˜: Yes                   |
|----------------------------------|
| ëª©í‘œ: Factoryì™€ Customsì—ì„œ       |
| ì„œë¥˜ê°€ë°© ì°¾ê¸°                     |
+----------------------------------+
```

---

## Error Handling

### ë¡œê·¸ í´ë” ì ‘ê·¼ ì˜¤ë¥˜
```csharp
try
{
    Process.Start("explorer.exe", logDirectory);
}
catch (Exception ex)
{
    // í´ë” ì—´ê¸° ì‹¤íŒ¨ ì‹œ ê²½ë¡œë¥¼ í´ë¦½ë³´ë“œì— ë³µì‚¬
    Clipboard.SetText(logDirectory);
    ShowMessage("í´ë”ë¥¼ ì—´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê²½ë¡œê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
}
```

### ë¹ˆ ë¡œê·¸ í´ë”
- ë¡œê·¸ íŒŒì¼ì´ ì—†ìœ¼ë©´ "ë¡œê·¸ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤" ë©”ì‹œì§€ í‘œì‹œ
- ê²Œì„ì„ í•œ ë²ˆ ì´ìƒ ì‹¤í–‰í•´ì•¼ ë¡œê·¸ê°€ ìƒì„±ë¨ì„ ì•ˆë‚´

---

## Testing

### Test Cases
1. ê³„ì • ì´ˆê¸°í™” ì•ˆë‚´ íŒì—… í‘œì‹œ/ìˆ¨ê¹€
2. "ë‹¤ì‹œ ë³´ì§€ ì•Šê¸°" ì„¤ì • ì €ì¥/ë¡œë“œ
3. "í´ë” ì—´ê¸°" ë²„íŠ¼ ë™ì‘
4. ì§„í–‰ì¤‘ í€˜ìŠ¤íŠ¸ ì •í™•íˆ ë¶„ë¥˜ë˜ëŠ”ì§€
5. ë™ì¼ í€˜ìŠ¤íŠ¸ì˜ ì‹œì‘â†’ì™„ë£Œ ì´ë²¤íŠ¸ ìˆœì„œ ì²˜ë¦¬
6. ë™ì¼ í€˜ìŠ¤íŠ¸ì˜ ì‹œì‘â†’ì‹¤íŒ¨â†’ì¬ì‹œì‘ ì´ë²¤íŠ¸ ì²˜ë¦¬
7. 2ì»¬ëŸ¼ ë ˆì´ì•„ì›ƒ ë°˜ì‘í˜• ë™ì‘
