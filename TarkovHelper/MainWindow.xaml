<Window x:Class="TarkovHelper.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:TarkovHelper"
        mc:Ignorable="d"
        Title="Tarkov Helper" Height="800" Width="1400"
        MinHeight="400" MinWidth="600"
        WindowStartupLocation="CenterScreen"
        Loaded="Window_Loaded">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="131*"/>
            <RowDefinition Height="161*"/>
        </Grid.RowDefinitions>
        <!-- Main Content with Blur Effect -->
        <Grid x:Name="MainContent" Grid.RowSpan="2">
            <Grid.Effect>
                <BlurEffect x:Name="BlurEffect" Radius="0"/>
            </Grid.Effect>

            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Title Bar -->
            <Border x:Name="TitleBar" Grid.Row="0" Background="{StaticResource BackgroundMediumBrush}" Padding="16,12">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0" Text="TARKOV HELPER" FontSize="{DynamicResource FontSizeXLarge}" FontWeight="Bold"
                               Foreground="{StaticResource AccentBrush}" VerticalAlignment="Center"/>

                    <!-- Right Side Controls -->
                    <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                        <!-- Player Level Control -->
                        <Border Background="{StaticResource BackgroundLightBrush}"
                                CornerRadius="4" Padding="4,2" Margin="0,0,12,0"
                                VerticalAlignment="Center">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Lv." FontSize="{DynamicResource FontSizeXSmall}" FontWeight="SemiBold"
                                           Foreground="{StaticResource TextSecondaryBrush}"
                                           VerticalAlignment="Center" Margin="4,0,4,0"/>
                                <Button x:Name="BtnLevelDown" Content="-" Width="24" Height="24"
                                        Padding="0" FontSize="{DynamicResource FontSizeSmall}" FontWeight="Bold"
                                        Click="BtnLevelDown_Click"
                                        ToolTip="Decrease level"/>
                                <TextBox x:Name="TxtPlayerLevel" Text="15" FontSize="{DynamicResource FontSizeSmall}" FontWeight="Bold"
                                         Foreground="{StaticResource AccentBrush}"
                                         Background="Transparent"
                                         BorderThickness="0"
                                         VerticalAlignment="Center" Margin="8,0"
                                         MinWidth="28" MaxWidth="40"
                                         TextAlignment="Center"
                                         VerticalContentAlignment="Center"
                                         PreviewTextInput="TxtPlayerLevel_PreviewTextInput"
                                         LostFocus="TxtPlayerLevel_LostFocus"
                                         KeyDown="TxtPlayerLevel_KeyDown"/>
                                <Button x:Name="BtnLevelUp" Content="+" Width="24" Height="24"
                                        Padding="0" FontSize="{DynamicResource FontSizeSmall}" FontWeight="Bold"
                                        Click="BtnLevelUp_Click"
                                        ToolTip="Increase level"/>
                            </StackPanel>
                        </Border>

                        <!-- Scav Rep Control -->
                        <Border Background="{StaticResource BackgroundLightBrush}"
                                CornerRadius="4" Padding="4,2" Margin="0,0,12,0"
                                VerticalAlignment="Center"
                                ToolTip="Scav Karma (Fence Reputation)">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Rep" FontSize="{DynamicResource FontSizeXSmall}" FontWeight="SemiBold"
                                           Foreground="{StaticResource TextSecondaryBrush}"
                                           VerticalAlignment="Center" Margin="4,0,4,0"/>
                                <Button x:Name="BtnScavRepDown" Content="-" Width="24" Height="24"
                                        Padding="0" FontSize="{DynamicResource FontSizeSmall}" FontWeight="Bold"
                                        Click="BtnScavRepDown_Click"
                                        ToolTip="Decrease Scav Rep (-0.1)"/>
                                <TextBox x:Name="TxtScavRep" Text="1.0" FontSize="{DynamicResource FontSizeSmall}" FontWeight="Bold"
                                         Foreground="{StaticResource AccentBrush}"
                                         Background="Transparent"
                                         BorderThickness="0"
                                         VerticalAlignment="Center" Margin="8,0"
                                         MinWidth="36" MaxWidth="48"
                                         TextAlignment="Center"
                                         VerticalContentAlignment="Center"
                                         PreviewTextInput="TxtScavRep_PreviewTextInput"
                                         LostFocus="TxtScavRep_LostFocus"
                                         KeyDown="TxtScavRep_KeyDown"/>
                                <Button x:Name="BtnScavRepUp" Content="+" Width="24" Height="24"
                                        Padding="0" FontSize="{DynamicResource FontSizeSmall}" FontWeight="Bold"
                                        Click="BtnScavRepUp_Click"
                                        ToolTip="Increase Scav Rep (+0.1)"/>
                            </StackPanel>
                        </Border>

                        <!-- DSP Decode Count Control -->
                        <Border Background="{StaticResource BackgroundLightBrush}"
                                CornerRadius="4" Padding="4,2" Margin="0,0,12,0"
                                VerticalAlignment="Center"
                                ToolTip="DSP Radio Transmitter Decode Count (Make Amends quest branch)">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="DSP" FontSize="{DynamicResource FontSizeXSmall}" FontWeight="SemiBold"
                                           Foreground="{StaticResource TextSecondaryBrush}"
                                           VerticalAlignment="Center" Margin="4,0,8,0"/>
                                <Button x:Name="BtnDsp0" Content="0" Width="24" Height="24"
                                        Padding="0" FontSize="{DynamicResource FontSizeSmall}" FontWeight="Bold"
                                        Click="BtnDsp_Click" Tag="0"
                                        ToolTip="0 Decodes - No Make Amends quest"/>
                                <Button x:Name="BtnDsp1" Content="1" Width="24" Height="24"
                                        Padding="0" FontSize="{DynamicResource FontSizeSmall}" FontWeight="Bold"
                                        Click="BtnDsp_Click" Tag="1" Margin="2,0,0,0"
                                        ToolTip="1 Decode - Make Amends: Buyout"/>
                                <Button x:Name="BtnDsp2" Content="2" Width="24" Height="24"
                                        Padding="0" FontSize="{DynamicResource FontSizeSmall}" FontWeight="Bold"
                                        Click="BtnDsp_Click" Tag="2" Margin="2,0,0,0"
                                        ToolTip="2 Decodes - Make Amends: Security"/>
                                <Button x:Name="BtnDsp3" Content="3" Width="24" Height="24"
                                        Padding="0" FontSize="{DynamicResource FontSizeSmall}" FontWeight="Bold"
                                        Click="BtnDsp_Click" Tag="3" Margin="2,0,0,0"
                                        ToolTip="3 Decodes - Make Amends: Software"/>
                            </StackPanel>
                        </Border>

                        <!-- Buy me a coffee -->
                        <Button x:Name="BtnCoffee" Content="â˜• Support" Padding="10,6"
                                Margin="0,0,8,0" Click="BtnCoffee_Click"
                                ToolTip="Buy me a coffee"/>

                        <!-- Refresh Data -->
                        <Button x:Name="BtnRefreshData" Content="ðŸ”„ Refresh" Padding="10,6"
                                Margin="0,0,8,0" Click="BtnRefreshData_Click"
                                ToolTip="Refresh data from API"/>

                        <!-- Reset Progress -->
                        <Button x:Name="BtnResetProgress" Content="â†© Reset" Padding="10,6"
                                Margin="0,0,8,0" Click="BtnResetProgress_Click"
                                ToolTip="Reset all progress"/>

                        <!-- Settings -->
                        <Button x:Name="BtnSettings" Content="âš™" Padding="10,6"
                                Margin="0,0,12,0" Click="BtnSettings_Click"
                                FontSize="{DynamicResource FontSizeMedium}"
                                ToolTip="Settings"/>

                        <!-- Language Selector -->
                        <ComboBox x:Name="CmbLanguage" Width="60"
                                  SelectionChanged="CmbLanguage_SelectionChanged">
                            <ComboBoxItem Content="EN" Tag="EN"/>
                            <ComboBoxItem Content="KO" Tag="KO"/>
                            <ComboBoxItem Content="JA" Tag="JA"/>
                        </ComboBox>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Main Content Area -->
            <Grid Grid.Row="1">
                <!-- Welcome Text (shown when no data) -->
                <TextBlock x:Name="TxtWelcome" Text="Welcome to Tarkov Helper"
                           FontSize="{DynamicResource FontSizeHeader}" FontWeight="Light"
                           Foreground="{StaticResource TextSecondaryBrush}"
                           HorizontalAlignment="Center" VerticalAlignment="Center"
                           Visibility="Collapsed"/>

                <!-- Tab Content Area -->
                <Grid x:Name="TabContentArea" Visibility="Collapsed">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Tab Navigation -->
                    <Border x:Name="TabNavigation" Grid.Row="0" Background="{StaticResource BackgroundMediumBrush}" Padding="16,0">
                        <StackPanel Orientation="Horizontal">
                            <RadioButton x:Name="TabQuests" Content="Quests"
                                         Style="{StaticResource TabButtonStyle}"
                                         IsChecked="True"
                                         Checked="Tab_Checked"/>
                            <RadioButton x:Name="TabHideout" Content="Hideout"
                                         Style="{StaticResource TabButtonStyle}"
                                         Checked="Tab_Checked"/>
                            <RadioButton x:Name="TabItems" Content="Items"
                                         Style="{StaticResource TabButtonStyle}"
                                         Checked="Tab_Checked"/>
                            <RadioButton x:Name="TabCollector" Content="Collector"
                                         Style="{StaticResource TabButtonStyle}"
                                         Checked="Tab_Checked"/>
                            <RadioButton x:Name="TabMapTracker" Content="Map"
                                         Style="{StaticResource TabButtonStyle}"
                                         Checked="Tab_Checked"/>
                        </StackPanel>
                    </Border>

                    <!-- Tab Content -->
                    <ContentControl x:Name="PageContent" Grid.Row="1"/>
                </Grid>
            </Grid>
        </Grid>

        <!-- Loading Overlay -->
        <Grid x:Name="LoadingOverlay" Visibility="Collapsed" Background="#AA1A1A1A" Grid.RowSpan="2">
            <Border Background="{StaticResource BackgroundDarkBrush}"
                    CornerRadius="8" Padding="32,24"
                    HorizontalAlignment="Center" VerticalAlignment="Center"
                    MinWidth="320">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="20" ShadowDepth="0" Opacity="0.5"/>
                </Border.Effect>
                <StackPanel>
                    <TextBlock Text="Loading Data" FontSize="{DynamicResource FontSizeLarge}" FontWeight="SemiBold"
                               Foreground="{StaticResource AccentBrush}"
                               HorizontalAlignment="Center" Margin="0,0,0,16"/>
                    <ProgressBar x:Name="LoadingProgressBar"
                                 Height="6" IsIndeterminate="True"
                                 Foreground="{StaticResource AccentBrush}"
                                 Background="{StaticResource BackgroundMediumBrush}"/>
                    <TextBlock x:Name="LoadingStatusText"
                               Text="Initializing..."
                               FontSize="{DynamicResource FontSizeXSmall}" Margin="0,12,0,0"
                               Foreground="{StaticResource TextSecondaryBrush}"
                               HorizontalAlignment="Center"
                               TextWrapping="Wrap" MaxWidth="280"/>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Settings Overlay -->
        <Grid x:Name="SettingsOverlay" Visibility="Collapsed" Background="#AA1A1A1A" Grid.RowSpan="2"
              MouseDown="SettingsOverlay_MouseDown">
            <Border Background="{StaticResource BackgroundDarkBrush}"
                    CornerRadius="8" Padding="24"
                    HorizontalAlignment="Center" VerticalAlignment="Center"
                    MinWidth="800" MaxWidth="900" MaxHeight="550">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="20" ShadowDepth="0" Opacity="0.5"/>
                </Border.Effect>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Header -->
                    <Grid Grid.Row="0" Margin="0,0,0,20">
                        <TextBlock x:Name="TxtSettingsTitle" Text="Settings" FontSize="{DynamicResource FontSizeTitle}" FontWeight="SemiBold"
                                   Foreground="{StaticResource AccentBrush}"/>
                        <Button x:Name="BtnCloseSettings" Content="âœ•"
                                HorizontalAlignment="Right"
                                Padding="8,4" FontSize="{DynamicResource FontSizeSmall}"
                                Click="BtnCloseSettings_Click"/>
                    </Grid>

                    <!-- Scrollable Content -->
                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="24"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Left Column -->
                            <StackPanel Grid.Column="0">
                                <!-- Log Folder Section -->
                                <TextBlock x:Name="TxtLogFolderLabel" Text="Tarkov Log Folder"
                                           FontSize="{DynamicResource FontSizeSmall}" FontWeight="SemiBold"
                                           Foreground="{StaticResource TextPrimaryBrush}"
                                           Margin="0,0,0,8"/>

                                <TextBlock x:Name="TxtLogFolderDesc"
                                           Text="Set the path to Tarkov's Logs folder for automatic quest completion tracking."
                                           FontSize="{DynamicResource FontSizeXSmall}"
                                           Foreground="{StaticResource TextSecondaryBrush}"
                                           TextWrapping="Wrap"
                                           Margin="0,0,0,12"/>

                                <!-- Current Path Display -->
                                <Border Background="{StaticResource BackgroundMediumBrush}"
                                        CornerRadius="4" Padding="12,8" Margin="0,0,0,8">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock x:Name="TxtCurrentLogPath"
                                                   Text="Not configured"
                                                   FontSize="{DynamicResource FontSizeXSmall}"
                                                   Foreground="{StaticResource TextSecondaryBrush}"
                                                   TextTrimming="CharacterEllipsis"
                                                   VerticalAlignment="Center"/>
                                        <StackPanel Grid.Column="1" Orientation="Horizontal">
                                            <TextBlock x:Name="TxtDetectionMethod"
                                                       Text=""
                                                       FontSize="{DynamicResource FontSizeTiny}"
                                                       Foreground="{StaticResource AccentBrush}"
                                                       VerticalAlignment="Center"
                                                       Margin="8,0"/>
                                        </StackPanel>
                                    </Grid>
                                </Border>

                                <!-- Status Indicator -->
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                                    <Ellipse x:Name="LogFolderStatusIndicator"
                                             Width="8" Height="8"
                                             Fill="#FF4444"
                                             VerticalAlignment="Center"
                                             Margin="0,0,8,0"/>
                                    <TextBlock x:Name="TxtLogFolderStatus"
                                               Text="Invalid path"
                                               FontSize="{DynamicResource FontSizeXSmall}"
                                               Foreground="{StaticResource TextSecondaryBrush}"/>
                                </StackPanel>

                                <!-- Action Buttons -->
                                <WrapPanel Orientation="Horizontal" HorizontalAlignment="Left">
                                    <Button x:Name="BtnAutoDetect" Content="Auto Detect"
                                            Padding="12,8" Margin="0,0,8,8"
                                            Click="BtnAutoDetect_Click"/>
                                    <Button x:Name="BtnBrowseLogFolder" Content="Browse..."
                                            Padding="12,8" Margin="0,0,8,8"
                                            Click="BtnBrowseLogFolder_Click"/>
                                    <Button x:Name="BtnResetLogFolder" Content="Reset"
                                            Padding="12,8" Margin="0,0,0,8"
                                            Click="BtnResetLogFolder_Click"/>
                                </WrapPanel>

                                <!-- Quest Sync Section -->
                                <Border BorderThickness="0,1,0,0" BorderBrush="{StaticResource BorderBrush}"
                                        Margin="0,12,0,0" Padding="0,16,0,0">
                                    <StackPanel>
                                        <TextBlock x:Name="TxtQuestSyncLabel" Text="Quest Log Sync"
                                                   FontSize="{DynamicResource FontSizeSmall}" FontWeight="SemiBold"
                                                   Foreground="{StaticResource TextPrimaryBrush}"
                                                   Margin="0,0,0,8"/>

                                        <TextBlock x:Name="TxtQuestSyncDesc"
                                                   Text="Synchronize quest progress from game log files. This will analyze your Tarkov logs and update completed quests."
                                                   FontSize="{DynamicResource FontSizeXSmall}"
                                                   Foreground="{StaticResource TextSecondaryBrush}"
                                                   TextWrapping="Wrap"
                                                   Margin="0,0,0,12"/>

                                        <!-- Monitoring Status -->
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                            <Ellipse x:Name="MonitoringStatusIndicator"
                                                     Width="8" Height="8"
                                                     Fill="#FF4444"
                                                     VerticalAlignment="Center"
                                                     Margin="0,0,8,0"/>
                                            <TextBlock x:Name="TxtMonitoringStatus"
                                                       Text="Not monitoring"
                                                       FontSize="{DynamicResource FontSizeXSmall}"
                                                       Foreground="{StaticResource TextSecondaryBrush}"/>
                                        </StackPanel>

                                        <WrapPanel Orientation="Horizontal" HorizontalAlignment="Left">
                                            <Button x:Name="BtnSyncQuest" Content="Sync Quest"
                                                    Padding="12,8" Margin="0,0,8,8"
                                                    Click="BtnSyncQuest_Click"/>
                                            <Button x:Name="BtnToggleMonitoring" Content="Start Monitoring"
                                                    Padding="12,8" Margin="0,0,0,8"
                                                    Click="BtnToggleMonitoring_Click"/>
                                        </WrapPanel>

                                        <!-- Enter In-Progress Quests Button -->
                                        <Button x:Name="BtnInProgressQuestInput" Content="Enter In-Progress Quests"
                                                Padding="12,8" Margin="0,4,0,0"
                                                HorizontalAlignment="Left"
                                                Click="BtnInProgressQuestInput_Click"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>

                            <!-- Right Column -->
                            <StackPanel Grid.Column="2">
                                <!-- Cache Management Section -->
                                <TextBlock Text="Cache Management"
                                           FontSize="{DynamicResource FontSizeSmall}" FontWeight="SemiBold"
                                           Foreground="{StaticResource TextPrimaryBrush}"
                                           Margin="0,0,0,8"/>

                                <TextBlock Text="Clear cached wiki pages and downloaded data. Use this if you encounter data issues or want to re-download everything."
                                           FontSize="{DynamicResource FontSizeXSmall}"
                                           Foreground="{StaticResource TextSecondaryBrush}"
                                           TextWrapping="Wrap"
                                           Margin="0,0,0,12"/>

                                <!-- Cache Size Display -->
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                    <TextBlock Text="Cache Size: "
                                               FontSize="{DynamicResource FontSizeXSmall}"
                                               Foreground="{StaticResource TextSecondaryBrush}"/>
                                    <TextBlock x:Name="TxtCacheSize"
                                               Text="Calculating..."
                                               FontSize="{DynamicResource FontSizeXSmall}"
                                               Foreground="{StaticResource TextPrimaryBrush}"/>
                                </StackPanel>

                                <WrapPanel Orientation="Horizontal" HorizontalAlignment="Left">
                                    <Button x:Name="BtnClearCache" Content="Clear Cache"
                                            Padding="12,8" Margin="0,0,8,8"
                                            Click="BtnClearCache_Click"/>
                                    <Button x:Name="BtnClearAllData" Content="Clear All Data"
                                            Padding="12,8" Margin="0,0,0,8"
                                            Click="BtnClearAllData_Click"
                                            ToolTip="Clear cache and all downloaded data (tasks, items, etc.)"/>
                                </WrapPanel>

                                <!-- Font Size Section -->
                                <Border BorderThickness="0,1,0,0" BorderBrush="{StaticResource BorderBrush}"
                                        Margin="0,12,0,0" Padding="0,16,0,0">
                                    <StackPanel>
                                        <TextBlock Text="Font Size"
                                                   FontSize="{DynamicResource FontSizeSmall}" FontWeight="SemiBold"
                                                   Foreground="{StaticResource TextPrimaryBrush}"
                                                   Margin="0,0,0,8"/>

                                        <TextBlock Text="Adjust the base font size for the application."
                                                   FontSize="{DynamicResource FontSizeXSmall}"
                                                   Foreground="{StaticResource TextSecondaryBrush}"
                                                   TextWrapping="Wrap"
                                                   Margin="0,0,0,12"/>

                                        <!-- Font Size Control -->
                                        <Grid Margin="0,0,0,8">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <Button x:Name="BtnFontSizeDown" Content="-" Width="32" Height="32"
                                                    Grid.Column="0" Padding="0" FontSize="{DynamicResource FontSizeMedium}" FontWeight="Bold"
                                                    Click="BtnFontSizeDown_Click"/>

                                            <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                                                <TextBlock x:Name="TxtCurrentFontSize" Text="16"
                                                           FontSize="{DynamicResource FontSizeLarge}" FontWeight="Bold"
                                                           Foreground="{StaticResource AccentBrush}"
                                                           VerticalAlignment="Center"/>
                                                <TextBlock Text=" pt"
                                                           FontSize="{DynamicResource FontSizeSmall}"
                                                           Foreground="{StaticResource TextSecondaryBrush}"
                                                           VerticalAlignment="Center"/>
                                            </StackPanel>

                                            <Button x:Name="BtnFontSizeUp" Content="+" Width="32" Height="32"
                                                    Grid.Column="2" Padding="0" FontSize="{DynamicResource FontSizeMedium}" FontWeight="Bold"
                                                    Click="BtnFontSizeUp_Click"/>
                                        </Grid>

                                        <Button x:Name="BtnResetFontSize" Content="Reset to Default"
                                                Padding="12,8" HorizontalAlignment="Left"
                                                Click="BtnResetFontSize_Click"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </Grid>
                    </ScrollViewer>
                </Grid>
            </Border>
        </Grid>

        <!-- Wipe Warning Overlay -->
        <Grid x:Name="WipeWarningOverlay" Visibility="Collapsed" Background="#AA1A1A1A" Grid.RowSpan="2"
              MouseDown="WipeWarningOverlay_MouseDown">
            <Border Background="{StaticResource BackgroundDarkBrush}"
                    CornerRadius="8" Padding="24"
                    HorizontalAlignment="Center" VerticalAlignment="Center"
                    MinWidth="500" MaxWidth="600">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="20" ShadowDepth="0" Opacity="0.5"/>
                </Border.Effect>
                <StackPanel>
                    <!-- Header -->
                    <Grid Margin="0,0,0,16">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="âš ï¸" FontSize="{DynamicResource FontSizeHeader}" VerticalAlignment="Center" Margin="0,0,12,0"/>
                            <TextBlock x:Name="TxtWipeWarningTitle" Text="í€˜ìŠ¤íŠ¸ ë™ê¸°í™” ì „ í™•ì¸" FontSize="{DynamicResource FontSizeXLarge}" FontWeight="SemiBold"
                                       Foreground="{StaticResource AccentBrush}" VerticalAlignment="Center"/>
                        </StackPanel>
                        <Button x:Name="BtnCloseWipeWarning" Content="âœ•"
                                HorizontalAlignment="Right"
                                Padding="8,4" FontSize="{DynamicResource FontSizeSmall}"
                                Click="BtnCloseWipeWarning_Click"/>
                    </Grid>

                    <!-- Warning Message -->
                    <TextBlock x:Name="TxtWipeWarningMessage"
                               Text="ìµœê·¼ ê³„ì • ì´ˆê¸°í™”(ì™€ì´í”„)ë¥¼ ì§„í–‰í•˜ì…¨ë‚˜ìš”?"
                               FontSize="{DynamicResource FontSizeSmall}" FontWeight="SemiBold"
                               Foreground="{StaticResource TextPrimaryBrush}"
                               TextWrapping="Wrap"
                               Margin="0,0,0,12"/>

                    <TextBlock x:Name="TxtWipeWarningDesc"
                               Text="ê³„ì • ì´ˆê¸°í™” í›„ ë™ê¸°í™”ë¥¼ ì§„í–‰í•˜ë©´ ì´ì „ ì‹œì¦Œì˜ ë¡œê·¸ê°€ ì„žì—¬ í€˜ìŠ¤íŠ¸ ì§„í–‰ ìƒíƒœê°€ ì˜¬ë°”ë¥´ì§€ ì•Šê²Œ í‘œì‹œë  ìˆ˜ ìžˆìŠµë‹ˆë‹¤."
                               FontSize="{DynamicResource FontSizeXSmall}"
                               Foreground="{StaticResource TextSecondaryBrush}"
                               TextWrapping="Wrap"
                               Margin="0,0,0,16"/>

                    <!-- Log Folder Path -->
                    <Border Background="{StaticResource BackgroundMediumBrush}"
                            CornerRadius="4" Padding="12" Margin="0,0,0,12">
                        <StackPanel>
                            <TextBlock x:Name="TxtLogFolderPathLabel" Text="ðŸ“ ë¡œê·¸ í´ë” ìœ„ì¹˜:"
                                       FontSize="{DynamicResource FontSizeXSmall}" FontWeight="SemiBold"
                                       Foreground="{StaticResource TextPrimaryBrush}"
                                       Margin="0,0,0,4"/>
                            <TextBlock x:Name="TxtWipeWarningLogPath"
                                       Text=""
                                       FontSize="{DynamicResource FontSizeTiny}"
                                       Foreground="{StaticResource TextSecondaryBrush}"
                                       TextTrimming="CharacterEllipsis"/>
                        </StackPanel>
                    </Border>

                    <!-- Recommendation -->
                    <TextBlock x:Name="TxtWipeWarningRecommendation"
                               Text="ðŸ’¡ ê¶Œìž¥ ì¡°ì¹˜: ê³„ì • ì´ˆê¸°í™” ì´ì „ ë‚ ì§œì˜ ë¡œê·¸ í´ë”ë¥¼ ì‚­ì œí•˜ê±°ë‚˜ ë‹¤ë¥¸ ìœ„ì¹˜ë¡œ ë°±ì—…í•´ ì£¼ì„¸ìš”."
                               FontSize="{DynamicResource FontSizeXSmall}"
                               Foreground="{StaticResource AccentBrush}"
                               TextWrapping="Wrap"
                               Margin="0,0,0,16"/>

                    <!-- Don't show again checkbox -->
                    <CheckBox x:Name="ChkHideWipeWarning"
                              Content="ì´ ì•ˆë‚´ë¥¼ ë‹¤ì‹œ ë³´ì§€ ì•Šê¸°"
                              Foreground="{StaticResource TextSecondaryBrush}"
                              Margin="0,0,0,16"/>

                    <!-- Action Buttons -->
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button x:Name="BtnOpenLogFolder" Content="í´ë” ì—´ê¸°"
                                Padding="16,8" Margin="0,0,8,0"
                                Click="BtnOpenLogFolder_Click"/>
                        <Button x:Name="BtnContinueSync" Content="ê³„ì† ì§„í–‰"
                                Padding="16,8"
                                Click="BtnContinueSync_Click"
                                Background="{StaticResource AccentBrush}"
                                Foreground="{StaticResource BackgroundDarkBrush}"/>
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Sync Result Confirmation Overlay -->
        <Grid x:Name="SyncResultOverlay" Visibility="Collapsed" Background="#AA1A1A1A" Grid.RowSpan="2">
            <Border Background="{StaticResource BackgroundDarkBrush}"
                    CornerRadius="8" Padding="24"
                    HorizontalAlignment="Center" VerticalAlignment="Center"
                    MinWidth="700" MaxWidth="850" MaxHeight="550">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="20" ShadowDepth="0" Opacity="0.5"/>
                </Border.Effect>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Header -->
                    <Grid Grid.Row="0" Margin="0,0,0,16">
                        <TextBlock x:Name="TxtSyncResultTitle" Text="Quest Sync Result" FontSize="{DynamicResource FontSizeXLarge}" FontWeight="SemiBold"
                                   Foreground="{StaticResource AccentBrush}"/>
                        <Button x:Name="BtnCloseSyncResult" Content="âœ•"
                                HorizontalAlignment="Right"
                                Padding="8,4" FontSize="{DynamicResource FontSizeSmall}"
                                Click="BtnCloseSyncResult_Click"/>
                    </Grid>

                    <!-- Two Column Layout -->
                    <Grid Grid.Row="1" Margin="0,0,0,12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="12"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Completed Quests Column -->
                        <Border Grid.Column="0" Background="{StaticResource BackgroundMediumBrush}"
                                CornerRadius="4">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                <Border Grid.Row="0" Background="{StaticResource BackgroundLightBrush}"
                                        CornerRadius="4,4,0,0" Padding="12,8">
                                    <TextBlock x:Name="TxtCompletedQuestsHeader" Text="ì™„ë£Œëœ í€˜ìŠ¤íŠ¸ (0)"
                                               FontSize="{DynamicResource FontSizeSmall}" FontWeight="SemiBold"
                                               Foreground="{StaticResource TextPrimaryBrush}"/>
                                </Border>
                                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" MaxHeight="280">
                                    <ItemsControl x:Name="SyncQuestList">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border BorderThickness="0,0,0,1" BorderBrush="{StaticResource BorderBrush}"
                                                        Padding="12,6">
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto"/>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>
                                                        <CheckBox Grid.Column="0" IsChecked="{Binding IsSelected, Mode=TwoWay}"
                                                                  VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                            <TextBlock Text="{Binding QuestName}"
                                                                       FontSize="{DynamicResource FontSizeXSmall}"
                                                                       Foreground="{StaticResource TextPrimaryBrush}"/>
                                                            <TextBlock Text="{Binding Trader}"
                                                                       FontSize="{DynamicResource FontSizeTiny}"
                                                                       Foreground="{StaticResource TextSecondaryBrush}"/>
                                                        </StackPanel>
                                                        <Border Grid.Column="2"
                                                                Background="{StaticResource AccentBrush}"
                                                                CornerRadius="3" Padding="4,2"
                                                                VerticalAlignment="Center"
                                                                Visibility="{Binding IsPrerequisite, Converter={StaticResource BoolToVisibilityConverter}}">
                                                            <TextBlock Text="Auto" FontSize="{DynamicResource FontSizeTiny}"
                                                                       Foreground="{StaticResource BackgroundDarkBrush}"/>
                                                        </Border>
                                                    </Grid>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </ScrollViewer>
                            </Grid>
                        </Border>

                        <!-- In Progress Quests Column -->
                        <Border Grid.Column="2" Background="{StaticResource BackgroundMediumBrush}"
                                CornerRadius="4">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                <Border Grid.Row="0" Background="{StaticResource BackgroundLightBrush}"
                                        CornerRadius="4,4,0,0" Padding="12,8">
                                    <TextBlock x:Name="TxtInProgressQuestsHeader" Text="ì§„í–‰ì¤‘ í€˜ìŠ¤íŠ¸ (0)"
                                               FontSize="{DynamicResource FontSizeSmall}" FontWeight="SemiBold"
                                               Foreground="{StaticResource TextPrimaryBrush}"/>
                                </Border>
                                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" MaxHeight="280">
                                    <ItemsControl x:Name="InProgressQuestList">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border BorderThickness="0,0,0,1" BorderBrush="{StaticResource BorderBrush}"
                                                        Padding="12,6">
                                                    <StackPanel>
                                                        <StackPanel Orientation="Horizontal">
                                                            <TextBlock Text="â—" FontSize="{DynamicResource FontSizeTiny}"
                                                                       Foreground="#FFA726"
                                                                       VerticalAlignment="Center"
                                                                       Margin="0,0,6,0"/>
                                                            <TextBlock Text="{Binding Name}"
                                                                       FontSize="{DynamicResource FontSizeXSmall}"
                                                                       Foreground="{StaticResource TextPrimaryBrush}"/>
                                                        </StackPanel>
                                                        <TextBlock Text="{Binding Trader}"
                                                                   FontSize="{DynamicResource FontSizeTiny}"
                                                                   Foreground="{StaticResource TextSecondaryBrush}"
                                                                   Margin="16,0,0,0"/>
                                                    </StackPanel>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </ScrollViewer>
                            </Grid>
                        </Border>
                    </Grid>

                    <!-- Summary Stats -->
                    <Border Grid.Row="2" Background="{StaticResource BackgroundMediumBrush}"
                            CornerRadius="4" Padding="12,8" Margin="0,0,0,16">
                        <StackPanel>
                            <TextBlock x:Name="TxtSyncSummary"
                                       Text="ìš”ì•½:"
                                       FontSize="{DynamicResource FontSizeXSmall}" FontWeight="SemiBold"
                                       Foreground="{StaticResource TextPrimaryBrush}"
                                       Margin="0,0,0,4"/>
                            <TextBlock x:Name="TxtSyncStats"
                                       Text=""
                                       FontSize="{DynamicResource FontSizeTiny}"
                                       Foreground="{StaticResource TextSecondaryBrush}"
                                       TextWrapping="Wrap"/>
                        </StackPanel>
                    </Border>

                    <!-- Action Buttons -->
                    <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button x:Name="BtnCancelSync" Content="Cancel"
                                Padding="16,8" Margin="0,0,8,0"
                                Click="BtnCancelSync_Click"/>
                        <Button x:Name="BtnConfirmSync" Content="Confirm"
                                Padding="16,8"
                                Click="BtnConfirmSync_Click"
                                Background="{StaticResource AccentBrush}"
                                Foreground="{StaticResource BackgroundDarkBrush}"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>

        <!-- In-Progress Quest Input Overlay -->
        <Grid x:Name="InProgressQuestInputOverlay" Visibility="Collapsed" Background="#AA1A1A1A" Grid.RowSpan="2"
              MouseDown="InProgressQuestInputOverlay_MouseDown">
            <Border Background="{StaticResource BackgroundDarkBrush}"
                    CornerRadius="8" Padding="24"
                    HorizontalAlignment="Center" VerticalAlignment="Center"
                    MinWidth="850" MaxWidth="950" MaxHeight="650">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="20" ShadowDepth="0" Opacity="0.5"/>
                </Border.Effect>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Header -->
                    <Grid Grid.Row="0" Margin="0,0,0,16">
                        <TextBlock x:Name="TxtInProgressQuestTitle" Text="Enter In-Progress Quests" FontSize="20" FontWeight="SemiBold"
                                   Foreground="{StaticResource AccentBrush}"/>
                        <Button x:Name="BtnCloseInProgressQuestInput" Content="âœ•"
                                HorizontalAlignment="Right"
                                Padding="8,4" FontSize="14"
                                Click="BtnCloseInProgressQuestInput_Click"/>
                    </Grid>

                    <!-- Two Column Layout -->
                    <Grid Grid.Row="1" Margin="0,0,0,12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="16"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Left Panel: Quest Selection -->
                        <Border Grid.Column="0" Background="{StaticResource BackgroundMediumBrush}"
                                CornerRadius="4">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <!-- Header -->
                                <Border Grid.Row="0" Background="{StaticResource BackgroundLightBrush}"
                                        CornerRadius="4,4,0,0" Padding="12,8">
                                    <TextBlock x:Name="TxtQuestSelectionHeader" Text="Quest Selection"
                                               FontSize="{DynamicResource FontSizeSmall}" FontWeight="SemiBold"
                                               Foreground="{StaticResource TextPrimaryBrush}"/>
                                </Border>

                                <!-- Search and Filter -->
                                <StackPanel Grid.Row="1" Margin="12,8">
                                    <!-- Search Box -->
                                    <TextBox x:Name="TxtQuestSearch"
                                             Padding="8,6" Margin="0,0,0,8"
                                             Background="{StaticResource BackgroundDarkBrush}"
                                             Foreground="{StaticResource TextPrimaryBrush}"
                                             BorderBrush="{StaticResource BorderBrush}"
                                             TextChanged="TxtQuestSearch_TextChanged"/>

                                    <!-- Trader Filter -->
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock x:Name="TxtTraderFilterLabel" Text="Trader:"
                                                   FontSize="{DynamicResource FontSizeXSmall}"
                                                   Foreground="{StaticResource TextSecondaryBrush}"
                                                   VerticalAlignment="Center" Margin="0,0,8,0"/>
                                        <ComboBox x:Name="CmbQuestTraderFilter" Width="140"
                                                  SelectionChanged="CmbQuestTraderFilter_SelectionChanged"/>
                                    </StackPanel>
                                </StackPanel>

                                <!-- Quest List -->
                                <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto" Margin="0,0,0,8">
                                    <ItemsControl x:Name="QuestSelectionList">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border BorderThickness="0,0,0,1" BorderBrush="{StaticResource BorderBrush}"
                                                        Padding="12,6">
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto"/>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>
                                                        <CheckBox Grid.Column="0" IsChecked="{Binding IsSelected, Mode=TwoWay}"
                                                                  IsEnabled="{Binding IsEnabled}"
                                                                  VerticalAlignment="Center" Margin="0,0,8,0"
                                                                  Checked="QuestSelection_CheckChanged"
                                                                  Unchecked="QuestSelection_CheckChanged"/>
                                                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                            <TextBlock Text="{Binding DisplayName}"
                                                                       FontSize="{DynamicResource FontSizeXSmall}"
                                                                       Foreground="{Binding TextColor}"/>
                                                            <TextBlock Text="{Binding SubtitleName}"
                                                                       FontSize="{DynamicResource FontSizeTiny}"
                                                                       Foreground="{StaticResource TextSecondaryBrush}"
                                                                       Visibility="{Binding SubtitleVisibility}"/>
                                                            <TextBlock Text="{Binding TraderName}"
                                                                       FontSize="{DynamicResource FontSizeTiny}"
                                                                       Foreground="{StaticResource TextSecondaryBrush}"/>
                                                        </StackPanel>
                                                    </Grid>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </ScrollViewer>
                            </Grid>
                        </Border>

                        <!-- Right Panel: Prerequisites Preview -->
                        <Border Grid.Column="2" Background="{StaticResource BackgroundMediumBrush}"
                                CornerRadius="4">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <!-- Header -->
                                <Border Grid.Row="0" Background="{StaticResource BackgroundLightBrush}"
                                        CornerRadius="4,4,0,0" Padding="12,8">
                                    <TextBlock x:Name="TxtPrerequisitesHeader" Text="Prerequisites Preview"
                                               FontSize="{DynamicResource FontSizeSmall}" FontWeight="SemiBold"
                                               Foreground="{StaticResource TextPrimaryBrush}"/>
                                </Border>

                                <!-- Description -->
                                <TextBlock x:Name="TxtPrerequisitesDesc" Grid.Row="1"
                                           Text="Prerequisites of selected quests will be shown here.&#x0a;These will be auto-completed on apply."
                                           FontSize="{DynamicResource FontSizeTiny}" Margin="12,8"
                                           Foreground="{StaticResource TextSecondaryBrush}"
                                           TextWrapping="Wrap"/>

                                <!-- Prerequisites List -->
                                <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto" Margin="0,0,0,8">
                                    <ItemsControl x:Name="PrerequisitesList">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border BorderThickness="0,0,0,1" BorderBrush="{StaticResource BorderBrush}"
                                                        Padding="12,6">
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto"/>
                                                            <ColumnDefinition Width="*"/>
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock Grid.Column="0" Text="âœ“" FontSize="{DynamicResource FontSizeXSmall}"
                                                                   Foreground="{StaticResource AccentBrush}"
                                                                   VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                            <TextBlock Text="{Binding DisplayName}"
                                                                       FontSize="{DynamicResource FontSizeXSmall}"
                                                                       Foreground="{StaticResource TextPrimaryBrush}"/>
                                                            <TextBlock Text="{Binding SubtitleName}"
                                                                       FontSize="{DynamicResource FontSizeTiny}"
                                                                       Foreground="{StaticResource TextSecondaryBrush}"
                                                                       Visibility="{Binding SubtitleVisibility}"/>
                                                            <TextBlock Text="{Binding TraderName}"
                                                                       FontSize="{DynamicResource FontSizeTiny}"
                                                                       Foreground="{StaticResource TextSecondaryBrush}"/>
                                                        </StackPanel>
                                                    </Grid>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </ScrollViewer>
                            </Grid>
                        </Border>
                    </Grid>

                    <!-- Summary Stats -->
                    <Border Grid.Row="2" Background="{StaticResource BackgroundMediumBrush}"
                            CornerRadius="4" Padding="12,8" Margin="0,0,0,16">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock x:Name="TxtSelectedQuestsCount"
                                       Text="Selected quests: 0"
                                       FontSize="{DynamicResource FontSizeXSmall}"
                                       Foreground="{StaticResource TextPrimaryBrush}"
                                       Margin="0,0,24,0"/>
                            <TextBlock x:Name="TxtPrerequisitesCount"
                                       Text="Prerequisites to complete: 0"
                                       FontSize="{DynamicResource FontSizeXSmall}"
                                       Foreground="{StaticResource TextSecondaryBrush}"/>
                        </StackPanel>
                    </Border>

                    <!-- Action Buttons -->
                    <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button x:Name="BtnCancelInProgressInput" Content="Cancel"
                                Padding="16,8" Margin="0,0,8,0"
                                Click="BtnCancelInProgressInput_Click"/>
                        <Button x:Name="BtnApplyInProgressInput" Content="Apply"
                                Padding="16,8"
                                Click="BtnApplyInProgressInput_Click"
                                Background="{StaticResource AccentBrush}"
                                Foreground="{StaticResource BackgroundDarkBrush}"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </Grid>

</Window>
